<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <title>HUD Language Trainer – WebGL Demo</title>
  <style>
    body{background:#0b0b0b;color:#e5e5e5;font-family:system-ui,Arial,sans-serif;margin:0;display:flex;flex-direction:column;align-items:center;gap:12px;padding:16px}
    #wrap{display:flex;gap:16px;flex-wrap:wrap;align-items:flex-start}
    canvas{width:1024px;max-width:95vw;height:auto;border:1px solid #222;background:black;border-radius:8px}
    .panel{background:#111;border:1px solid #222;border-radius:8px;padding:12px;min-width:260px}
    input[type=range]{width:100%}
    a{color:#8ad}
    code{background:#111;padding:2px 4px;border-radius:4px;border:1px solid #222}
  </style>
</head>
<body>
  <h1>HUD Language Trainer – WebGL2</h1>
  <div id="wrap">
    <canvas id="glcanvas" width="1024" height="256"></canvas>
    <div class="panel">
      <h3>Controls</h3>
      <label>Lock (u_lock): <span id="lockVal">0.00</span></label>
      <input id="lock" type="range" min="0" max="1" step="0.001" value="0"/>
      <label><input id="auto" type="checkbox" checked/> Auto-train to lock</label>
      <p>Drop-in study of an 80s visor UI that flickers English ↔ Toki Pona, then stabilizes on Toki Pona.</p>
      <p>Run on a static server (e.g. <code>python -m http.server</code>) to avoid cross-origin issues.</p>
      <p>Assets: <code>assets/text/eng_line.png</code>, <code>assets/text/toki_line.png</code></p>
    </div>
  </div>

  <!-- Vertex shader -->
  <script id="vs" type="x-shader/x-vertex">#version 300 es
  precision mediump float;
  layout (location=0) in vec2 a_pos;
  layout (location=1) in vec2 a_uv;
  out vec2 v_uv;
  void main(){
    v_uv = a_uv;
    gl_Position = vec4(a_pos, 0.0, 1.0);
  }
  </script>

  <!-- Fragment shader (Study 1) -->
  <script id="fs" type="x-shader/x-fragment">#version 300 es
  precision mediump float;
  in vec2 v_uv;
  out vec4 fragColor;
  uniform sampler2D texEng;
  uniform sampler2D texToki;
  uniform vec2 u_res;
  uniform float u_time;
  uniform float u_lock; // 0..1

  float hash2(vec2 p){ return fract(sin(dot(p, vec2(12.9898,78.233))) * 43758.5453); }

  void main(){
    vec2 uv = v_uv;

    // horizontal tear
    float line = floor(uv.y * u_res.y);
    float tear = step(0.97, hash2(vec2(line, floor(u_time*6.0)))) * 0.008;
    uv.x += tear * (hash2(vec2(line+u_time, 1.23)) - 0.5);

    // language training mix (flicker -> lock)
    float flick = step(0.5, hash2(vec2(u_time*10.0, uv.y*13.0)));
    float mixLang = smoothstep(0.0, 1.0, mix(flick, 1.0, u_lock));

    // subtle chroma split
    vec2 shift = vec2(0.0015, 0.0);
    vec3 eng = vec3(
      texture(texEng, uv + shift).r,
      texture(texEng, uv).g,
      texture(texEng, uv - shift).b
    );
    vec3 tok = vec3(
      texture(texToki, uv + shift).r,
      texture(texToki, uv).g,
      texture(texToki, uv - shift).b
    );
    vec3 col = mix(eng, tok, mixLang);

    // scanlines + vignette
    float scan = 0.9 + 0.1 * sin(uv.y * u_res.y);
    float vig  = smoothstep(0.95, 0.6, length(uv - 0.5));
    col *= scan * (1.0 - 0.35 * vig);

    fragColor = vec4(col, 1.0);
  }
  </script>

  <script type="module" src="main.js"></script>
</body>
</html>
